#!/bin/sh

usage () { cat <<USAGE; }
usage: $(basename -- "$0" | sed 's/-/ /1') [-f] [-d default=SampShell_GIT_DEFAULT_MASTER_BRANCH]

Shows the current 'master' branch. IF -f is supplied, no master is fatal.
USAGE

default=${SampShell_GIT_DEFAULT_MASTER_BRANCH-master}
fatal=
while getopts 'd:f' opt; do
	case $opt in
		d) default=$OPTARG ;;
		h) usage; exit ;;
		f) fatal=1 ;;
		*) exit 2 ;; # I.e. usage error
	esac
done

shift $(( OPTIND - 1 ))

if [ "$#" -ne 0 ]; then
	usage >&2
	exit 2
fi

git rev-parse --is-inside-work-tree >/dev/null || exit
base=$(git symbolic-ref refs/remotes/origin/HEAD -q) || \
	if [ -n "$fatal" ]; then
		echo >&2 cant find master
		exit 1
	else
		base="$default"
	fi

basename -- "$base"
