#!/bin/sh

set -o nounset

# It's overwritten in `ssubl`
scriptname=${SampShell_subl_scriptname:-subl}

usage () { [ "$#" -ne 0 ] && echo "$*" >&2 ; cat >&2; exit 255; } <<USAGE
usage: $scriptname [options] [--] [file ...]"
options:
	-h     print help
	-c     creates non-existing files/dirs
	-eNAME set the editor; overrides \$SampShell_EDITOR.
USAGE

editor=${SampShell_EDITOR:-TextEdit}
create=

until [ "$#" -eq 0 ]; do
	case "$1" in 
	-h|--help) usage ;;
	-c) create=1 ;;
	-e*)
		editor="${1#-e}"
		if [ -z "$editor" ]; then
			[ "$#" -eq 1 ] && usage 'missing required argument for -e'
			shift
			editor="${1}"
		fi ;;
	--) shift; break ;;
	*) break;
	esac
	shift
done

[ "$#" = 0 ] && set -- "${PWD}"

if [ -n "$create" ]; then
	for file; do
		if [ -z "$file" ]; then
			echo "$scriptname: empty filename given; not creating it" >&2
			exit 1
		fi

		# File exists, no need to make it.
		[ -e "$file" ] && continue

		# If the file ends with `/`, then it's a directory and we create it.
		if [ "${file%/}" != "$file" ]; then
			mkdir -p "$file" || exit
		else
			{ mkdir -p "$(dirname "$file")" && touch "$file"; } || exit
		fi
	done
fi

open -a "${editor}" -- "$@"
