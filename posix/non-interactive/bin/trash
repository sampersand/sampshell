#!/bin/sh

set -o nounset

warn () { msg="%s: $1"'\n'; shift; printf "$msg" "$scriptname" "$@" >&2; }
die () { warn "$@"; exit 1; }
usage () { cat <<EOS >&2; exit 255; }
usage: $scriptname [-h/--help] [-tTRASHDIR] [--] [files ...]
   Moves files to the trash, possibly renaming them. The trash dir is
   controlled by the variable 'SampShell_TRASHDIR'
EOS


scriptname=$(basename -- "$0"; echo x); scriptname=${scriptname%?x}
trashdir=${SampShell_TRASHDIR:-$SampShell_ROOTDIR/.trash}

until [ "$#" -eq 0 ]; do
	case "$1" in
		--) shift; break;;
		-h|--help) usage ;;
		-t*)
			trashdir=${1#-t}
			shift
			if [ -z "$trashdir" ]; then
				trashdir=${1-}
				if [ "$#" -eq 0 ] || [ -z "$1" ]; then
					die 1 'missing trash directory for -t'
				fi
			fi ;;
		(*) break ;;
	esac
	shift
done

[ -z "$trashdir" ] && die "missing trashdir; pass it with '-t' or set \$SampShell_TRASHDIR"
[ "$#" -eq 0 ] && usage

if [ ! -d "$trashdir" ]; then
	[ -e "$trashdir" ] && die "trashdir exists, but isn't a dir: %s" "$trashdir"
	mkdir -p "$trashdir" || exit
fi

mv-safe -rC -- "$@" "$trashdir"
