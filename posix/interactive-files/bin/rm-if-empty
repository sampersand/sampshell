#!/bin/sh

if [ "$#" -ne 0 ] && [ "$1" = -- ]; then
	shift
elif [ "$#" -eq 0 ] || [ "$1" = -h ] || [ "$1" = --help ]; then
	cat <<EOS >&2
usage: $(basename "$0") [-h/--help] [--] file ...
removes files if theyre not empty.
returns:
	0 all files were empty and removed
	1 at least one file was non-empty (and thus not removed)
	2 at least one file didn't exist
EOS
	exit 255
fi

# Keep track of the last non-zero exit status
exit_status=0

for filename; do
	if [ ! -e "$filename" ]; then
		exit_status=2
	elif [ -f "$filename" ] && [ ! -s "$filename" ]; then
		command -p rm -- "$filename"
	elif [ -d "$filename" ] && ! ls -A1q -- "$filename" | grep -q .; then
		command -p rm -d -- "$filename"
	else
		exit_status=1
	fi || exit_status=$?
done

exit "$exit_status"
